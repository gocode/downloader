<link rel="import" href="/static/bower_components/polymer/polymer.html">
<link rel="import" href="/static/bower_components/paper-item/paper-item.html">
<link rel="import" href="/static/bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="/static/bower_components/paper-item/paper-item-body.html">
<link rel="import" href="/static/bower_components/paper-progress/paper-progress.html">
<link rel="import" href="/static/bower_components/iron-collapse/iron-collapse.html">

<dom-module id="go-resource">
	<style>
		paper-progress {
			width: 100%;
		}
		iron-collapse {
			width: 100%; 
		}
		paper-item-body {
			width: 100%;
		}
		.container {
			border: 1px solid lightgrey;
		}
	</style>

	<template>
		<div class="container">
		<paper-item>
			<paper-icon-button icon="expand-more" on-click="toggle"></paper-icon-button>
			<paper-item-body>
				<span>[[resource.Url]] - [[resourcePct]] %</span>
				<paper-progress value="[[resourcePct]]"></paper-progress>
			</paper-item-body>
			<paper-icon-button icon="av:pause"></paper-icon-button>
			<paper-icon-button icon="av:stop"></paper-icon-button>
		</paper-item>
		<iron-collapse id="collapse">
			<template is="dom-repeat" items="[[resource.Sections]]">
				<paper-icon-item>
					<paper-item-body>
						<span>Section [[item.Id]] - [[item.PctComplete]] %</span>
						<paper-progress value="[[item.PctComplete]]"></paper-progress>
					</paper-item-body>
					<paper-icon-button icon="av:pause"></paper-icon-button>
				</paper-icon-item>
			</template>
		</iron-collapse>
		</div>
	</template>

	<script>
		Polymer({
			is: 'go-resource',

			properties: {
				resource: {
					type: Object,
					observer: '_calcResourcePct'
				},
				resourcePct: String
			},

			_calcResourcePct: function(newValue, oldValue) {
				var pct = 0;
				for (var i = 0; i < newValue.Sections.length; i++) {
					pct = pct + newValue.Sections[i].PctComplete;
				}
        		this.resourcePct = pct/newValue.Sections.length;
      		},

			toggle: function() {
				this.$.collapse.toggle();
			}
		});
	</script>
</dom-module>